<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/787F2ADD-D7E8-CF49-9835-D44E8E6FFEA8/main.js" charset="UTF-8"></script>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://d3js.org/d3-color.v1.min.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
    <script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
    <script src="https://rawgit.com/andreasplesch/aframe-meshline-component/master/dist/aframe-meshline-component.min.js"></script>
  <style>
    body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; background-color: white;}
   
  </style>
</head>

<body>
  <a-scene>
      <!-- Camera with customized cursor -->
      <a-light color="#da47da" position="0 5 0" type="ambient"></a-light>
    	<a-entity camera look-controls wasd-controls>
        <a-entity position="0 0 -0.5"
                  geometry="primitive: ring; radiusOuter: 0.01; radiusInner: 0.007;"
                  material="color: black; shader: flat;"
                  cursor="maxDistance: 500; fuse: true; timeout: 1000">
            </a-entity>
            <a-entity geometry="primitive: plane; height: 2; width: 2.5;" scale="0 0 0"  id="test" position="0 0 -2" visible="false" material="shader:flat; src:details.png; opacity:0.8">
                <a-animation attribute="scale" begin="fade" to="1 1 1" easing="ease-in-out"></a-animation>
            </a-entity>
      </a-entity> 
    	<a-entity light="type: directional; color: #FFF; intensity: 0.5" position="0 3 0"> </a-entity>
      <!-- Sky -->
      <a-sky color="#695c5c"> </a-sky>

<!--  Makes the entity fully transparent. only possible with Material component's attribute visible equals False -->
    <a-entity id="main" geometry="primitive : box; depth : 8; height : 8; width : 8" position="-12 -1 -8" scale="0.5 0.5 0.5" material="visible : false;">
        <a-animation attribute="rotation"
               begin="antirotate"
               dur="25000"
               from="0 0 0"
               to="0 360 0"        
               fill="forwards"
               repeat="indefinite"
               easing="linear"
               id="anime"
               end="endanim">
        </a-animation>
        
        <a-entity  text="value : Age; align : center; width : 70; color: #000; font:roboto; side : double" position="9 -3 -8"></a-entity>
        <a-entity  text="value : Duration; align : center; width : 70; color: #000; font:roboto; side : double" position="-11 10 -8" rotation="0 20 90"></a-entity> 
        <a-entity  text="value : Months; align : center; width : 70; color: #000; font:roboto; side : double" position="-8 -3 12" rotation="0 90 0"></a-entity>
        <!-- For z tick marks -->
        <a-entity  meshline="lineWidth : 5; path : -8 -9 -7.5, -8 -7 -7.5; color : #000">
            <a-entity  text="value : May; align : center; width : 12; color: #000; font:roboto; side : double" position="-8 -7.5 -6.9" rotation="0 90 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 -9 -4.056, -8 -7 -4.056; color : #000">
            <a-entity  text="value : June; align : center; width : 12; color: #000; font:roboto; side : double" position="-8 -7.5 -3.3" rotation="0 90 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 -9 -0.612, -8 -7 -0.612; color : #000">
            <a-entity  text="value : November; align : center; width : 12; color: #000; font:roboto; side : double" position="-8 -7.5 0.8" rotation="0 90 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 -9 2.832, -8 -7 2.832; color : #000">
            <a-entity  text="value : September; align : center; width : 12; color: #000; font:roboto; side : double" position="-8 -7.5 4.3" rotation="0 90 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 -9 6.276, -8 -7 6.276; color : #000">
            <a-entity  text="value : July; align : center; width : 12; color: #000; font:roboto; side : double" position="-8 -7.5 7" rotation="0 90 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 -9 9.72, -8 -7 9.72; color : #000">
            <a-entity  text="value : August; align : center; width : 12; color: #000; font:roboto; side : double" position="-8 -7.5 10.8" rotation="0 90 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 -9 13.164, -8 -7 13.164; color : #000">
            <a-entity  text="value : March; align : center; width : 12; color: #000; font:roboto; side : double" position="-8 -7.5 14.1" rotation="0 90 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 -9 16.608, -8 -7 16.608; color : #000">
            <a-entity  text="value : October; align : center; width : 12; color: #000; font:roboto; side : double" position="-8 -7.5 17.8" rotation="0 90 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 -9 20.052, -8 -7 20.052; color : #000">
            <a-entity  text="value : April; align : center; width : 12; color: #000; font:roboto; side : double" position="-8 -7.5 20.8" rotation="0 90 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 -9 23.496, -8 -7 23.496; color : #000">
            <a-entity  text="value : December; align : center; width : 12; color: #000; font:roboto; side : double" position="-8 -7.5 24.8" rotation="0 90 0"></a-entity>
        </a-entity>

        <!-- For x tick marks -->
        <a-entity  meshline="lineWidth : 5; path : -7.5 -9 -8, -7.5 -7 -8; color : #000">
            <a-entity  text="value : 18; align : center; width : 12; color: #000; font:roboto; side : double" position="-7 -7.5 -8"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -4.056 -9 -8, -4.056 -7 -8; color : #000">
            <a-entity  text="value : 26; align : center; width : 12; color: #000; font:roboto; side : double" position="-3.5 -7.5 -8"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -0.612 -9 -8, -0.612 -7 -8; color : #000">
            <a-entity  text="value : 34; align : center; width : 12; color: #000; font:roboto; side : double" position="-0.1 -7.5 -8"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : 2.832 -9 -8, 2.832 -7 -8; color : #000">
            <a-entity  text="value : 42; align : center; width : 12; color: #000; font:roboto; side : double" position="3.3 -7.5 -8"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : 6.276 -9 -8, 6.276 -7 -8; color : #000">
            <a-entity  text="value : 50; align : center; width : 12; color: #000; font:roboto; side : double" position="6.8 -7.5 -8"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : 9.72 -9 -8, 9.72 -7 -8; color : #000">
            <a-entity  text="value : 58; align : center; width : 12; color: #000; font:roboto; side : double" position="10.2 -7.5 -8"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : 13.164 -9 -8, 13.164 -7 -8; color : #000">
            <a-entity  text="value : 64; align : center; width : 12; color: #000; font:roboto; side : double" position="13.7 -7.5 -8"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : 16.608 -9 -8, 16.608 -7 -8; color : #000">
            <a-entity  text="value : 72; align : center; width : 12; color: #000; font:roboto; side : double" position="17.1 -7.5 -8"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : 20.052 -9 -8, 20.052 -7 -8; color : #000">
            <a-entity  text="value : 80; align : center; width : 12; color: #000; font:roboto; side : double" position="20.5 -7.5 -8"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : 23.496 -9 -8, 23.496 -7 -8; color : #000">
            <a-entity  text="value : 88; align : center; width : 12; color: #000; font:roboto; side : double" position="24 -7.5 -8"></a-entity>
        </a-entity>
          <!-- For y tick marks -->
        <a-entity  meshline="lineWidth : 5; path : -8 -7 -8, -7 -7 -8; color : #000">
            <a-entity  text="value : 0; align : center; width : 15; color: #000; font:roboto; side : double" position="-6.9 -6.5 -8" rotation="0 45 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 -4.056 -8, -7 -4.056 -8; color : #000">
            <a-entity  text="value : 405; align : center; width : 15; color: #000; font:roboto; side : double" position="-6.9 -3.5 -8" rotation="0 45 0"></a-entity>
        </a-entity>
         <a-entity  meshline="lineWidth : 5; path : -8 -0.612 -8, -7 -0.612 -8; color : #000">
            <a-entity  text="value : 810; align : center; width : 15; color: #000; font:roboto; side : double" position="-6.9 -0.2 -8" rotation="0 45 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 2.832 -8, -7 2.832 -8; color : #000">
            <a-entity  text="value : 1215; align : center; width : 15; color: #000; font:roboto; side : double" position="-6.9 3.2 -8" rotation="0 45 0"></a-entity>
        </a-entity>
         <a-entity  meshline="lineWidth : 5; path : -8 6.276 -8, -7 6.276 -8; color : #000">
            <a-entity  text="value : 1620; align : center; width : 15; color: #000; font:roboto; side : double" position="-6.9 6.7 -8" rotation="0 45 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 9.72 -8, -7 9.72 -8; color : #000">
            <a-entity  text="value : 2025; align : center; width : 15; color: #000; font:roboto; side : double" position="-6.9 10.2 -8" rotation="0 45 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 13.164 -8, -7 13.164 -8; color : #000">
            <a-entity  text="value : 2430; align : center; width : 15; color: #000; font:roboto; side : double" position="-6.9 13.5 -8" rotation="0 45 0"></a-entity>
        </a-entity>
         <a-entity  meshline="lineWidth : 5; path : -8 16.608 -8, -7 16.608 -8; color : #000">
            <a-entity  text="value : 2835; align : center; width : 15; color: #000; font:roboto; side : double" position="-6.9 17 -8" rotation="0 45 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 20.052 -8, -7 20.052 -8; color : #000">
            <a-entity  text="value : 3240; align : center; width : 15; color: #000; font:roboto; side : double" position="-6.9 20.5 -8" rotation="0 45 0"></a-entity>
        </a-entity>
        <a-entity  meshline="lineWidth : 5; path : -8 23.496 -8, -7 23.496 -8; color : #000">
            <a-entity  text="value : 3645; align : center; width : 15; color: #000; font:roboto; side : double" position="-6.9 23.9 -8" rotation="0 45 0"></a-entity>
        </a-entity>

      </a-entity> 
     <a-entity geometry="primitive: plane; height: 1; width: 1; shader : flat"  id="rot" position="-1 0 2" rotation="0 135 0"></a-entity>
     <a-entity geometry="primitive: plane; height: 1; width: 1; shader : flat"  id="stopr" position="-1 -2 2" rotation="0 135 0"></a-entity> 
      <a-entity geometry="primitive: plane; height: 50; width: 50;" material="color: #10a237" position="-5 -5 0" rotation="-90 0 0"></a-entity> 
      <a-entity geometry="primitive: plane; height: 15; width: 50;" material="color: #41ff41" position="-5 2 -25" rotation="0 0 0"></a-entity>
      <a-entity geometry="primitive: plane; height: 15; width: 50;" material="color: #41ff41" position="-5 2 25" rotation="0 180 0"></a-entity>
      <a-entity geometry="primitive: plane; height: 15; width: 50;" material="color: #41ff41" position="-25 2 0" rotation="0 90 0"></a-entity>
      <a-entity geometry="primitive: plane; height: 15; width: 50;" material="color: #41ff41" position="20 2 0" rotation="0 -90 0"></a-entity>
      
      
           <a-entity geometry="primitive: plane; height: 1; width: 1; shader : flat"  id="minus" position="0 -3 0" rotation="-45 90 0"></a-entity>
           <a-entity geometry="primitive: plane; height: 1; width: 1; shader : flat"  id="jobs" position="0 -3 -2" rotation="-45 90 0"></a-entity>
           <a-entity geometry="primitive: plane; height: 1; width: 1; shader : flat"  id="plus" position="0 -3 -4" rotation="-45 90 0"></a-entity>

    </a-scene>
  <script>
      
       // To get DOM attribute of aframe elements in javascript --> document.getElementById("main").getDOMAttribute('geometry').width;

      var ewidth = document.getElementById("main").getDOMAttribute('geometry').width;
      //  console.log(ewidth);
            
      // Accessing the main DOM entity which acts as a placeholder for the three axes. Giant Invisible box with predefined width, height and depth.
          
         var entity = d3.select("a-scene").select("#main");
      
      //Padding for x y and z axis
        var padding = -7.5;
      
      //convert csv to array for months(string)
        var months = [];
      
    
      // Loading csv file and converting it into array of objects with proper data-type ***  IMPORTANT: Asynchronous method first above then third call and second function itself executes OR just put the entire logic code inside this function ****
      
     
      
      d3.csv("bank-additional - Copy.csv", function(error, data){
          data.forEach(function(d) {
              d.age = parseInt(d.age);
              d.campaign = +d.campaign;
              d["cons.conf.idx"] = +d["cons.conf.idx"];
              d["cons.price.idx"] = +d["cons.price.idx"];
              d.duration = +d.duration;
              d["emp.var.rate"] = +d["emp.var.rate"];
              d.euribor3m = +d.euribor3m;
              d["nr.employed"] = +d["nr.employed"];
              d.pdays = +d.pdays;
              d.previous = +d.previous;
              
           //   console.log(d);
              months.push(d.month);
              months;
          });
          
          // x scale age variable
          var xscale = d3.scaleLinear()
                         .domain([d3.min(data, function(d) { return d.age; }),d3.max(data, function(d) { return d.age; })])
                         .range([padding , (2 * ewidth)-padding]);
        //  console.log(xscale.invert(-7.5));
          
          
          
          // y scale duration variable
          var yscale = d3.scaleLinear()
                         .domain([d3.max(data, function(d) { return d.duration; }),d3.min(data, function(d) { return d.duration; })])
                         .range([(2 * ewidth)-padding , padding]);
          
          
          // z scale months variable
          var zscale = d3.scalePoint()
                         .domain(months)
                         .range([padding , (2 * ewidth)-padding]);
          
          // size campaign variable
          var size = d3.scaleLinear()
                       .domain([d3.min(data, function(d) { return d.campaign; }),d3.max(data,function(d){ return d.campaign; })])
                       .range([0.2,0.8])
          
          // color job variable
             var color = d3.scaleOrdinal(d3.schemePaired);
          
        //  console.log(xscale(18)); 
         // console.log(zscale.step());
        //  console.log(yscale(3643));
        //  console.log(color(15));
          
       //   var tooltest = document.getElementById('test');
          
        var tooltest = document.querySelector('#test');
          
          // x-axis  2 * ewidth = 16 units for axis line. for the empty placeholder its a bit different
       
          entity.append("a-entity")
                .attr("meshline","path : -"+ewidth+" -8 -8, "+ ewidth*3 +" -8 -8; lineWidth : 5; color : #000;");
       //         .call(xaxis);     
          
          // y-axis
          
          entity.append("a-entity")
                .attr("meshline","path : -8 -"+ewidth+" -8,-8 "+ ewidth*3 +" -8; lineWidth : 5; color : #000;");
          
          
          // z-axis 
          
          entity.append("a-entity")
                .attr("meshline","path : -8 -8 -"+ewidth+",-8 -8 "+ ewidth*3+"; lineWidth : 5; color : #000;");
    
       
          // spheres for the data itself
          
          entity.selectAll("a-box")
                .data(data)
                .enter().append("a-box")
                .attr("position", function(d,i){
                var x = xscale(d.age);
                var y = yscale(d.duration);
                var z = zscale(months[i]);
                              
                return x +" "+ y +" "+ z;
            })
                .attr("geometry","segmentsHeight : 1; segmentsWidth : 1")
                .attr("material",function(d){
                        return "color : " + color(d.marital);
            })
                .attr("geometry",function(d,i){
                  return "width :" + size(d.campaign) + ";depth :" + size(d.campaign) + "; height :" + size(d.campaign);
            })
                .on("click",function(d,i){
                    console.log(months[i])
                    tooltest.emit('fade')
                    tooltest.setAttribute('visible','true')
                 //   console.log(d3.select(this).size())
                    tooltest.setAttribute("text",{
                                      value : "Job Type : " + d.job + "\n" + 
                                      "Duration : " + d.duration + " secs \n" +
                                      "Age : " + d.age + "\n" +
                                      "Month : " + months[i] + "\n" +
                                      "Marital : " + d.marital,
                                      align : 'left',
                                      anchor : 'center',
                                      width : 2,
                                      color : 'white',
                                      font : 'kelsonsans',
                    })
               setTimeout(function(){tooltest.setAttribute('visible','false')},5000)
    
            })
                .on("mouseenter",function(d,i){
                    d3.select(this)
                      .attr("scale","1.5 1.5 1.5")
          })
                .on("mouseleave",function(d,i){
                    d3.select(this)
                      .attr("scale","1 1 1")
          })
          
         /*     .transition()                         // Animation for the term deposit YES
                .duration(1000)
                .ease(d3.easeElasticInOut)
                .on("start", function repeat() {
                          d3.active(this)
                            .attr("rotation", function(d){
                              if(d.y === "yes")
                                  return "0 90 0";
                          })
                            .transition().ease(d3.easeElasticInOut)
                            .attr("rotation", function(d){
                              if(d.y === "yes")
                                  return "0 0 0";})
                            .transition().ease(d3.easeElasticInOut)
                            .on("start", repeat);
            });
            
         */
         // console.log("Total points"+entity.selectAll('a-box').size());
          
        var rotate1 = document.querySelector('#rot');
        var stopr = document.querySelector('#stopr');
        var mains = document.querySelector('#main');
        var animes = 0;
        var functionrun = false;
          
        rotate1.addEventListener('click',function(){
            console.log("start animation")
            // mains.emit('antirotate');
            
            if(!functionrun){
                mains.emit('antirotate');
                functionrun = true;
            }else{
          //      console.log(animes)
           //     document.querySelector('#anime').setAttribute('from','0'+animes+'0')
        //        mains.flushToDOM(true);
                console.log("play animation")
                console.log(document.getElementById('anime'))
                mains.entity['a-animation'].play();
               // mains.emit('antirotate');
            } 
         })
         
          
        stopr.addEventListener('click',function(){
            console.log("pause animation")
            mains.pause()
       //     animes = document.getElementById('main').getAttribute('rotation').y 
         })
          
          
        /*  
          var jobs = document.querySelector('#jobs');
          var minus = document.querySelector('#minus');
          var plus = document.querySelector('#plus');
          
          minus.setAttribute('text',{
                 value : "admin",
                 align : 'center',
                 anchor : 'center',
                 width : 5,
                 color : 'black',
                 font : 'kelsonsans' 
          })
          plus.setAttribute('text',{
                 value : "+",
                 align : 'center',
                 anchor : 'center',
                 width : 5,
                 color : 'black',
                 font : 'kelsonsans' 
          })
        
          minus.addEventListener('click',function(){
              entity.selectAll('a-box').attr('opacity',function(d){
                  if(d.job !== "admin."){
                      return "0.2";
                  } 
              })
          })
          
          */
          
          
      });
  </script>
</body>
